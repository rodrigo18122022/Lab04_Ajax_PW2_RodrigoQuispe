<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ejercicio 7: Comparativo por Selección</title>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
    <h1>Comparativo por Selección de Regiones</h1>
    <select id="regionsSelect" multiple>
        <!-- Opciones de regiones se agregarán dinámicamente -->
    </select>
    <button id="loadSelectedComparative">Cargar Gráfico</button>
    <div id="selected_comparative_chart" style="width: 900px; height: 500px"></div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'data.json', true);

            xhr.onload = function() {
                if (this.status === 200) {
                    const data = JSON.parse(this.responseText);
                    const select = document.getElementById('regionsSelect');
                    data.forEach(region => {
                        const option = document.createElement('option');
                        option.value = region.region;
                        option.textContent = region.region;
                        select.appendChild(option);
                    });
                }
            };

            xhr.send();
        });

        document.getElementById('loadSelectedComparative').addEventListener('click', function() {
            const selectedRegions = Array.from(document.getElementById('regionsSelect').selectedOptions).map(option => option.value);

            if (selectedRegions.length === 0) {
                alert('Por favor selecciona al menos una región');
                return;
            }

            const xhr = new XMLHttpRequest();
            xhr.open('GET', 'data.json', true);

            xhr.onload = function() {
                if (this.status === 200) {
                    const data = JSON.parse(this.responseText);
                    const filteredData = data.filter(region => selectedRegions.includes(region.region));
                    const chartData = [['Fecha']];

                    filteredData.forEach(region => {
                        chartData[0].push(region.region);
                    });

                    const dates = filteredData[0].confirmed.map(day => day.date);
                    dates.forEach((date, index) => {
                        const row = [date];
                        filteredData.forEach(region => {
                            row.push(parseInt(region.confirmed[index].value));
                        });
                        chartData.push(row);
                    });

                    google.charts.load('current', { 'packages': ['corechart'] });
                    google.charts.setOnLoadCallback(function() {
                        var dataTable = google.visualization.arrayToDataTable(chartData);
                        var options = {
                            title: 'Comparativo de Casos Confirmados entre Regiones Seleccionadas',
                            curveType: 'function',
                            legend: { position: 'bottom' }
                        };
                        var chart = new google.visualization.LineChart(document.getElementById('selected_comparative_chart'));
                        chart.draw(dataTable, options);
                    });
                }
            };

            xhr.send();
        });
    </script>
</body>
</html>
